<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì—ìˆí…Œí¬ í™ˆíƒìŠ¤ ì‚¬ìš©í˜„í™©</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f4f6f8;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    .container {
      background-color: #fff;
      width: 90%;
      max-width: 500px;
      margin-top: 40px;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    h1 {
      text-align: center;
      font-size: 2em;
      margin-bottom: 30px;
      color: #333;
    }

    .card {
      background-color: #f9fafb;
      padding: 16px;
      border-radius: 10px;
      margin-bottom: 12px;
      border: 1px solid #e0e0e0;
    }

    .label {
      font-weight: 600;
      color: #555;
    }

    .value {
      float: right;
      font-weight: bold;
      color: #222;
    }

    select {
      width: 100%;
      padding: 10px;
      margin: 20px 0;
      font-size: 1em;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    .button-group {
      display: flex;
      justify-content: space-between;
      gap: 10px;
    }

    button {
      flex: 1;
      padding: 12px;
      font-size: 1em;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background-color: #007bff;
      color: white;
      transition: background-color 0.2s ease;
    }

    button:hover {
      background-color: #0056b3;
    }

    .queue-section {
      margin-top: 30px;
    }

    .queue-section h3 {
      font-size: 1.1em;
      margin-bottom: 10px;
      color: #444;
    }

    .queue-section ul {
      padding-left: 20px;
    }

    .queue-section li {
      margin-bottom: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ì—ìˆí…Œí¬ í™ˆíƒìŠ¤ ì‚¬ìš©í˜„í™©</h1>

    <div class="card">
      <div><span class="label">í˜„ì¬ ì‚¬ìš©ì</span> <span class="value" id="current-user">-</span></div>
    </div>
    <div class="card">
      <div><span class="label">ì‚¬ìš© ì‹œì‘ ì‹œê°„</span> <span class="value" id="start-time">-</span></div>
    </div>
    <div class="card">
      <div><span class="label">ë‹¤ìŒ ì‚¬ìš©ì</span> <span class="value" id="next-user">-</span></div>
    </div>

    <select id="user-select">
      <option value="">ì´ë¦„ì„ ì„ íƒí•˜ì„¸ìš”</option>
      <option>ê¹€ê°€ì˜</option>
      <option>ê¹€ê²½ë¯¼</option>
      <option>ê¹€ì›ì§„</option>
      <option>ë°•ë‚˜ì˜</option>
      <option>ì›íš¨ë¡œ</option>
      <option>ì´ì„¸ì—°</option>
      <option>ì¥ê²½ë¡</option>
      <option>ì¥ì§€í˜</option>
      <option>ì •ì§€ì„±</option>
      <option>í•œì‹ ì• </option>
    </select>

    <div class="button-group">
      <button onclick="startUse()">ì‚¬ìš© ì‹œì‘</button>
      <button onclick="endUse()">ì‚¬ìš© ì¢…ë£Œ</button>
      <button onclick="reserve()">ì˜ˆì•½</button>
    </div>

    <div class="queue-section">
      <h3>ì˜ˆì•½ì ëª©ë¡ (ìˆœë²ˆ í¬í•¨)</h3>
      <ul id="queue-list"></ul>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDQMGCVyByIQnqrbVYfTWTWVGcRhXrwRWY",
      authDomain: "essen-hometax.firebaseapp.com",
      databaseURL: "https://essen-hometax-default-rtdb.firebaseio.com",
      projectId: "essen-hometax",
      storageBucket: "essen-hometax.appspot.com",
      messagingSenderId: "240420662210",
      appId: "1:240420662210:web:4ca351a615167ab6fb845b"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const currentUserRef = db.ref("currentUser");
    const startTimeRef = db.ref("startTime");
    const queueRef = db.ref("queue");

    // ì•Œë¦¼ ê¶Œí•œ ìš”ì²­
    if (Notification.permission !== "granted") {
      Notification.requestPermission();
    }

    function getSelectedName() {
      return document.getElementById("user-select").value;
    }

    function startUse() {
      const name = getSelectedName();
      if (!name) return alert("ì‚¬ìš©ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");

      currentUserRef.once("value").then(snapshot => {
        if (snapshot.val()) {
          alert("ì´ë¯¸ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤.");
        } else {
          currentUserRef.set(name);
          startTimeRef.set(new Date().toLocaleTimeString());
          queueRef.once("value").then(qsnap => {
            const queue = qsnap.val() || [];
            const updated = queue.filter(user => user !== name);
            queueRef.set(updated);
          });
        }
      });
    }

    function endUse() {
      currentUserRef.set(null);
      startTimeRef.set("-");
      queueRef.once("value").then(snapshot => {
        const queue = snapshot.val() || [];
        if (queue.length > 0) {
          const next = queue[0];
          currentUserRef.set(next);
          startTimeRef.set(new Date().toLocaleTimeString());
          queueRef.set(queue.slice(1));

          // ğŸ”” ì•Œë¦¼ ì „ì†¡
          if (Notification.permission === "granted") {
            new Notification("í™ˆíƒìŠ¤ ìˆœì„œ ì•Œë¦¼", {
              body: `${next}ë‹˜! í™ˆíƒìŠ¤ ì‚¬ìš© ìˆœì„œì…ë‹ˆë‹¤.`,
              icon: "https://cdn-icons-png.flaticon.com/512/190/190411.png"
            });
          } else {
            alert(`${next}ë‹˜ ìˆœì„œì…ë‹ˆë‹¤.`);
          }
        }
      });
    }

    function reserve() {
      const name = getSelectedName();
      if (!name) return alert("ì‚¬ìš©ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
      queueRef.once("value").then(snapshot => {
        const queue = snapshot.val() || [];
        if (!queue.includes(name)) {
          queue.push(name);
          queueRef.set(queue);
        } else {
          alert("ì´ë¯¸ ì˜ˆì•½ ëª©ë¡ì— ìˆìŠµë‹ˆë‹¤.");
        }
      });
    }

    function updateUI() {
      currentUserRef.on("value", snapshot => {
        document.getElementById("current-user").textContent = snapshot.val() || "-";
      });
      startTimeRef.on("value", snapshot => {
        document.getElementById("start-time").textContent = snapshot.val() || "-";
      });
      queueRef.on("value", snapshot => {
        const list = document.getElementById("queue-list");
        list.innerHTML = "";
        const queue = snapshot.val() || [];
        queue.forEach((name, i) => {
          const li = document.createElement("li");
          li.textContent = `${i + 1}ìˆœìœ„: ${name}`;
          list.appendChild(li);
        });
        document.getElementById("next-user").textContent = queue.length > 0 ? queue[0] : "-";
      });
    }

    updateUI();
  </script>
</body>
</html>
